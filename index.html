<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
  </head>
  <body>
    <section id="tweets">
      <!-- Dynamically created in scripts -->
    </section>
    <script>

      $(document).ready(function(){
        var $body = $('body');
        var $tweets = $("#tweets");
        $tweets.html('');

        /* Original Code... may reuse
        // $body.html('');

        // var index = streams.home.length - 1;
        // while(index >= 0){
        //   var tweet = streams.home[index];
        //   var $tweet = $('<div></div>');
        //   $tweet.text('@' + tweet.user + ': ' + tweet.message);
        //   $tweet.appendTo($tweets);
        //   index -= 1;
        // }
        */

        // function to make other functions to update tweets array
        var updateTweetsFor = function(handle) {
          /*
            returns: function that updates list for a given twitter handle. Does
            not rebuild entire list, but prepends new entries to tweets list.
          */
          var $tweets;
          var start = 0;
          var end;
          var source;

          if (handle != undefined) {
            $tweets = $('#'+handle);
            source = streams.users[handle];
          } else {
            $tweets = $("#tweets");
            source = streams.home;
          }
          return function() {
            // get ending index when called
            end = source.length;
            // loop through, update tweets
            for (var i = start; i < end; i ++) {
              var tweet = source[i];
              var $tweet = $('<div></div>');
              $tweet.text('@' + tweet.user + ': ' + tweet.message);
              /* TODO: So far, adding to home stream. need to be able to
              add to individual streams */
              $tweet.prependTo($tweets);
            }
            // update next start index
            start = end;
          };
        };
        var update = {};
        update.home = updateTweetsFor();

        // initially create a stream/list for each user
        (function createStreams() {
          for (var user in streams.users) {
            $body.append("<section id=" + user + "></section>");

            // create updating function
            update[user] = updateTweetsFor(user);
          }
        })();
        update.home();

        // this is just to test auto-refreshing for different lists. will delete later
        setInterval(function() {
          update.home();
          update.mracus();
          update.shawndrost();
        }, 300)

      });

    </script>
  </body>
</html>

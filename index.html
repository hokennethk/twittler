<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
  </head>
  <body>
    <section id="tweets">
      <!-- Dynamically created in scripts -->
    </section>
    <script>

      $(document).ready(function(){
        var $body = $('body');
        var $tweets = $("#tweets");
        var start = 0;
        var tweetSource = streams.home;
        /* Original Code... may reuse
        // $body.html('');

        // var index = streams.home.length - 1;
        // while(index >= 0){
        //   var tweet = streams.home[index];
        //   var $tweet = $('<div></div>');
        //   $tweet.text('@' + tweet.user + ': ' + tweet.message);
        //   $tweet.appendTo($tweets);
        //   index -= 1;
        // }
        */


        var updateTweets = function() {
            // get ending index when called
            var end = tweetSource.length;
            // loop through, update tweets
            for (var i = start; i < end; i ++) {
              var tweet = tweetSource[i];
              var $tweet = $('<div></div>')
                            .addClass('tweet');
              var $user = $("<a></a>")
                          .attr("href", "#")
                          .addClass("user " + tweet.user)
                          .text("@" + tweet.user);
              var $createDate = $("<span></span>")
                                .addClass("created-date")
                                .text(tweet.created_at.toLocaleString());
              var $msg = $("<p></p>")
                          .addClass("tweet-message")
                          .text(tweet.message);
              // build tweet
              $tweet.append($user)
                    .append($createDate)
                    .append("<p>" + tweet.message + "</p>");
              $tweet.prependTo($tweets);
            }
            // update next start index
            start = end;
          };

        var filterTweets = function(user) {
          /* takes a user and filters the home tweets to only show
          that user's tweets
          Returns a jQuery object with the filtered out tweets */
          // select all tweets that do not belong to the user
          var $toHide = $tweets.find(".user").not("."+user).closest("div");
          $toHide.hide(1000);
          return $toHide;
        };

        updateTweets();

        // this section is for testing
        var interval = setInterval(function() {
          updateTweets();
        }, 300);

        setTimeout(function() {
          clearInterval(interval);
          // filterTweets("mracus");
        }, 10000);

      });

    </script>
  </body>
</html>
